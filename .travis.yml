language: bash
services: docker
env:
  global:
  - secure: Eu4FGj1SqEWz99dWeIkjwPan5me7Lu5vm0DJqnJFgIOOFIvBszCJMxu6c5HDqlvvz/XvwEReDWs+0HRm5/35KduVT3old1cRTXeCn0VGHJ1sl94sYXG8rlQwv6KLjaZ2VPCbZJJdx4yJev7OZvxibCOatwvpGnqM+r+FSC8YbZgyzj4ZEdDJt1ZDFsTpMGY70YIegK3YqRn/UNzttVjttSDFJ3F/Wq8P3zfaxSlh5VCHYkImuIn3o2jlJEmASjmzXJX+GoOKq4LNQ0Ftobkgjkllfmv55S1BlG2mlv37kY1Ei1vNWvydm0fpVYJnsJMioSVd04IeT5Vx8Cw6UdCtBiKQ7VfbIu7T9Fxu/ONPQ8UH/BQ9JJNo881HSqqcm8iQmBZbYGpUieTerMwsnF9laYMkWM3LYdYXOv6EshsbQ8QnB8mYyo+951750eKj7c4wrLSK/0cLBWZTjmf+XFyzubkq3c5vz1Uh3FP5wJI0Bd/3NIpCDaCwcu7uvV4aWMKAbzqpEw76w1XnA4mi7hB8uEoW2mwE1COLmiQrM2L9nvjgNX3B6aMm6SKfubTStipjDfTerG/x+xYBqUtXz8LPrwMGmKXc32R2RDnLvzjKlMVfL7+NENAkTpIFCmgfZ76kYXyEpNVoP0JAFPtk7vko3BjXeWzqLliKLjINkl/Yj00=
  - secure: Ftn3NjC1EivxgplT7GomFirW7hLavIFbQdrlQRE8sNCIpiPqsYLcjWf8gihZmuQoX+3aZXRxcUdBDCg7MRGCZ1kaRaIygD2q3kh3E5jEh5WutFoJ/xZSfJroUhx3zq9JyaoqyXQH4ro1In+IUnXK3sELGl9x/HZq5bkmQKYUh2kjCOKMSefEGThgMcCXFRLbgBYA+GLDSB8FQUh7azXNaMBWeh3Kilg2bnWvPgc1ojaHdkoRgeaOH2S5v0IZKSFYtOj9xhDZ9s3fAgS+N1ogOixl7yQgdYgFZzvlIBbYRhmQcVrvConja3kfQdZ0j8CyvgN+dOnBCTpgoP+hPpgZomif7MOjzvBfLSiVGB40Y9bI5W1e4nwFIEzUE8CM8lDSk4MAegrrJLp9Oh/pbaic5Vwz43qeN4AyQXLD6q9hBTtz59ZGCXTBhDVO6aRjfAq3kAlEK5i/CKmP7YDMA744YVqLSe84PBUNMbrWeEOM3BOZ/UBo6DBgUgzD/a21oiq+I6q92xKm3mPruxenD9XYFofj4Ly802NqrUCPkUBZeAqZaiNBOXY+r6mb2o1lXppfI+rcWxeCzD14Z7EgRfwMnNjC4YhcWkWyuD0swzPDwTupR1vfnuG+4LeVgV5RgbxiUDK3/sD3Bw6ZNi6lK5GbuOvG9q5P0SZxMVA9UCbmkhw=
  - secure: u9rNSJKLXM6I3QgxSLJvtUnDN8hrYSbev/F69DkkOiXLAgUx6+0s7iO7UKO+NtAfncGxPO1RElju/HRdSR2L4L6r/SwwsjfMhs/HzkfkZ2GYvInzI/Auj8qkUtA84eiAEbRH9VdVrPmSKS1iceRSQKsFOQF1kcndt/E0O921Do7CkTyOH/eHm8YKepepYZHW4U6VGyEcFyI5WpG0sltNDsOBn3hWYszesXKTil763dQJHqy5Np7kHNoT3uBvYtMUzC3i8aBhCHwQ1aQeYYOn0qn5i3E1zmpYt6dFkSZj7gBhRIBcv7u2GCV58Aw1h3bJyIGvnRt07sMk3niIHZwUK7itsVJ3DIP8rm1Xc15Q0GcWN301C033nS2un8mac+umb222lI2mfmaSjM7liDusAlcuV+83/OsEBulOhCFESr2JwPg7QFwBakWNP3xAgPhJtuC5EIsBBCQN3fjgv3Il0YItGeyB0NFAsK04ABTKwT+1vxRkQbzHT4LqiQkJhiREdH7Qa3o/1v+r8CpCgJrF/tPx2GXHVR6iJP4882NMdk00P4bAIxpBd3Ww4Odd5TgjhKTW8OWtkR04f2MI5yQrgbngzsNqxvDuLWPsm6EX5OMBqlz4VtXZYK9BmGIgktmFt/AUjx/mry3Mtf/I/3qk6ApQs2ilcYM3lTVYfa0F8NA=
install:
- git clone https://github.com/docker-library/official-images.git ~/official-images
script:
- export TAG=`if [ "$TRAVIS_BRANCH" == "master" ]; then echo "latest"; else echo $TRAVIS_BRANCH;
  fi`
- docker build -f Dockerfile -t ${TRAVIS_REPO_SLUG,,}:$TAG .
- ~/official-images/test/run.sh -t php-fpm-hello-web "${TRAVIS_REPO_SLUG,,}:$TAG"
after_success:
- docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
- docker tag ${TRAVIS_REPO_SLUG,,}:$TAG ${TRAVIS_REPO_SLUG,,}:travis-$TRAVIS_BUILD_NUMBER
- docker push ${TRAVIS_REPO_SLUG,,}
